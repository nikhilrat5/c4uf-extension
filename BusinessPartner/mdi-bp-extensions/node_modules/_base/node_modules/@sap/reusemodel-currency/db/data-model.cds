namespace cds.foundation.sap.currency;

using cds.foundation.sap.currency.CurrencyThreeLetterISOCode from './types';
using cds.foundation.sap.currency.CurrencyThreeDigitISOCode from './types';
using cds.foundation.sap.currency.CurrencyMinorUnitExponent from './types';
using cds.foundation.sap.currency.LanguageTwoLetterISOCode from './types';
using cds.foundation.sap.currency.CurrencyISOCodeName from './types';
using cds.foundation.sap.busconfign.BusinessConfiguration as BusConfigurationEntity from '@sap/BusinessConfigurationModel';

entity Currencies: BusConfigurationEntity {
	key CurrencyThreeLetterISOCode : CurrencyThreeLetterISOCode;
	CurrencyThreeDigitISOCode : CurrencyThreeDigitISOCode;
	CurrencyMinorUnitExponent : CurrencyMinorUnitExponent;
	text: Association to many CurrencyTexts on text.CurrencyThreeLetterISOCode = CurrencyThreeLetterISOCode and text.BusConfignVersion = BusConfignVersion; 
	localised: association[1] to CurrencyTexts on localised.CurrencyThreeLetterISOCode = CurrencyThreeLetterISOCode and localised.BusConfignVersion = BusConfignVersion and localised.CurrencyTextLanguageCode = SUBSTRING(SESSION_CONTEXT('LOCALE'),1,2); 
};

entity CurrencyTexts: BusConfigurationEntity {
	key CurrencyThreeLetterISOCode : CurrencyThreeLetterISOCode;
	key CurrencyTextLanguageCode : LanguageTwoLetterISOCode;
	CurrencyISOCodeName : CurrencyISOCodeName;
};

entity I_Currencies as select from Currencies{
	*
}excluding{BusConfignIsDeleted};

entity I_CurrencyTexts as select from CurrencyTexts{
	*
}excluding{BusConfignIsDeleted};

entity I_CurrenciesWithTexts as select from Currencies{
	key CurrencyThreeLetterISOCode,
	CurrencyThreeDigitISOCode,
	CurrencyMinorUnitExponent,
	key COALESCE(text.CurrencyTextLanguageCode, '') as CurrencyTextLanguageCode : LanguageTwoLetterISOCode,
	text.CurrencyISOCodeName,
	key BusConfignVersion
};

entity I_CurrenciesValueHelp as select from Currencies{
	key CurrencyThreeLetterISOCode,
	CurrencyThreeDigitISOCode,
	CurrencyMinorUnitExponent,
	key COALESCE(localised.CurrencyTextLanguageCode, '') as CurrencyTextLanguageCode : LanguageTwoLetterISOCode,
	localised.CurrencyISOCodeName,
	key BusConfignVersion
};

entity C_CurrenciesWithTexts as select from I_CurrenciesWithTexts{*};
entity C_CurrenciesValueHelp as select from I_CurrenciesValueHelp{*};
entity C_CurrencyTexts as select from I_CurrencyTexts{*};
entity C_Currencies as select from I_Currencies{*};
