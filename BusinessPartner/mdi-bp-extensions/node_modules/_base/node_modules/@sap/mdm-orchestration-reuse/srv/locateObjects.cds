namespace mdo;

using mdo.KeyMappingDistributionStatusOverviewTmpl as KeyMappingDistributionStatusOverviewTmpl from '../db/LocateObjectModel';
using mdo.KeyMappingDistributionStatusDetailTmpl as KeyMappingDistributionStatusDetailTmpl from '../db/LocateObjectModel';
using mdo.DistributionStatusSummaryOverview as DistributionStatusSummary  from '../db/LocateObjectModel';
using mdo.ProviderApplicationDestination as ProviderApplicationDestination  from '../db/SubscriptionDistributionModel';
using mdo.SubscriptionDistribution as SubscriptionDistribution  from '../db/SubscriptionDistributionModel';

service locateObject {
	
	@Capabilities.SearchRestrictions.Searchable: false
	@Capabilities: { Insertable:false, Updatable:false, Deletable:false }
    @Capabilities.FilterRestrictions.RequiredProperties: [ProviderDestination, ObjectTypeCode]
    @Capabilities.FilterRestrictions.NonFilterableProperties: [ObjectIdentifierType, MappingGroupId, Counter, ObjectIdentifierTypeText]
	view OverviewKeyMappingDistributionStatus as select from KeyMappingDistributionStatusOverviewTmpl{ 
		*,
		to_DistributionStatusSummary 	: redirected to DistributionStatusSummaries,
		to_GroupMember					: redirected to DetailKeyMappingDistributionStatus,
	};
	
	@Capabilities.SearchRestrictions.Searchable: false
	@Capabilities: { Insertable:false, Updatable:false, Deletable:false }
	view DetailKeyMappingDistributionStatus as select from  KeyMappingDistributionStatusDetailTmpl{ 
		*,
		0 as StatusColor : Integer
	};

	@Capabilities: { Insertable:false, Updatable:false, Deletable:false }
	view DistributionStatusSummaries as select from DistributionStatusSummary{
    	key ObjectInstanceKey,
    	key ReplicationStatus,
    	Counter,
    	0 as StatusColor : Integer
    	};
    	
    view ProviderDestinationVH as select from ProviderApplicationDestination{
    	key Destination,
    	To_Parent.LastActivatedAt
    } where To_Parent.LastActivatedAt is not null;
    
    view BusinessObjectTypeVH as select from SubscriptionDistribution{
    	key BusinessObjectType.objectTypeCode,
    	key BusinessObjectType.BusConfignVersion,
    	BusinessObjectType.description[language=SUBSTRING(SESSION_CONTEXT('LOCALE'),1,2)].description as localizedDescription,
    	LastActivatedAt
    } where LastActivatedAt is not null;

}
